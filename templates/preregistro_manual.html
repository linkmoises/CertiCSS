<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Preregistro Manual - {{ evento.nombre }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- favicons -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='assets/favicons/favicon-96x96.png') }}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='assets/favicons/favicon.svg') }}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='assets/favicons/apple-touch-icon.png') }}" />
    <meta name="apple-mobile-web-app-title" content="CertiCSS" />
    <link rel="manifest" href="{{ url_for('static', filename='assets/favicons/site.webmanifest') }}" />
{% if UMAMI_URL %}
    {{ UMAMI_URL | safe }}
{% endif %}
</head>
<body class="bg-gray-50 dark:bg-neutral-900">

    <!-- ========== MAIN CONTENT ========== -->
    <main id="content">
        <div class="max-w-4xl px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
            
            <!-- Card -->
            <div class="bg-white rounded-xl shadow p-4 sm:p-7 dark:bg-neutral-800">
                <div class="mb-8">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-neutral-200">
                        Preregistro Manual de Participantes
                    </h2>
                    <p class="text-sm text-gray-600 dark:text-neutral-400">
                        {{ evento.nombre }}
                    </p>
                </div>

                <!-- Mostrar mensajes -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="mb-6">
                    {% for category, message in messages %}
                    <div class="{{ 'bg-red-100 border border-red-200 text-red-800' if category == 'error' else 'bg-green-100 border border-green-200 text-green-800' if category == 'success' else 'bg-yellow-100 border border-yellow-200 text-yellow-800' }} px-4 py-3 rounded-lg text-sm mb-2">
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% endwith %}

                <!-- Formulario de preregistro -->
                <form action="{{ url_for('preregistro_manual', codigo_evento=evento.codigo) }}" method="post">
                    <div class="grid sm:grid-cols-12 gap-2 sm:gap-6">
                        
                        <div class="sm:col-span-3">
                            <label for="nombres" class="inline-block text-sm text-gray-800 mt-2.5 dark:text-neutral-200">
                                Nombres
                            </label>
                        </div>
                        
                        <div class="sm:col-span-9">
                            <input id="nombres" name="nombres" type="text" 
                                   class="py-2 px-3 pe-11 block w-full border-gray-200 shadow-sm text-sm rounded-lg focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600" 
                                   placeholder="Nombres del participante..." required>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="apellidos" class="inline-block text-sm text-gray-800 mt-2.5 dark:text-neutral-200">
                                Apellidos
                            </label>
                        </div>
                        
                        <div class="sm:col-span-9">
                            <input id="apellidos" name="apellidos" type="text" 
                                   class="py-2 px-3 pe-11 block w-full border-gray-200 shadow-sm text-sm rounded-lg focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600" 
                                   placeholder="Apellidos del participante..." required>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="cedula" class="inline-block text-sm text-gray-800 mt-2.5 dark:text-neutral-200">
                                Cédula
                            </label>
                        </div>
                        
                        <div class="sm:col-span-9">
                            <input id="cedula" name="cedula" type="text" 
                                   class="py-2 px-3 pe-11 block w-full border-gray-200 shadow-sm text-sm rounded-lg focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600" 
                                   placeholder="8-123-456" 
                                   onblur="validarCedula(this)" required>
                            <small id="cedula-error" class="text-red-500 text-sm hidden">Cédula inválida. Por favor, verifica el formato.</small>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="perfil_profesional" class="inline-block text-sm text-gray-800 mt-2.5 dark:text-neutral-200">
                                Perfil Profesional
                            </label>
                        </div>
                        
                        <div class="sm:col-span-9">
                            <select id="perfil_profesional" name="perfil_profesional" 
                                    class="py-2 px-3 pe-9 block w-full border-gray-200 shadow-sm text-sm rounded-lg focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600" required>
                                <option value="">Seleccione el perfil profesional</option>
                                <option value="medico_general">Médico General - Consulta Externa</option>
                                <option value="medico_urgencias">Médico General - Urgencias</option>
                                <option value="medico_administrativo">Médico Administrativo</option>
                                <option value="medico_especialista">Médico Especialista</option>
                                <option value="medico_residente">Medico Residente</option>
                                <option value="medico_interno">Médico Interno</option>
                                <option value="odontologo">Odontólogo(a)</option>
                                <option value="odontologo_especialista">Odontólogo(a) Especialista</option>
                                <option value="odontologo_interno">Odontólogo interno</option>
                                <option value="tao">Técnico en asistencia dental</option>
                                <option value="enfermero">Enfermera(o)</option>
                                <option value="tecnico_enfermeria">Técnico en Enfermería</option>
                                <option value="laboratorista">Laboratorista</option>
                                <option value="tecnico_laboratorio">Técnico de Laboratorio</option>
                                <option value="fisioterapeuta">Fisioterapeuta</option>
                                <option value="farmaceutico">Farmacéutico(a)</option>
                                <option value="fonoaudiologo">Fonoaudiólogo(a)</option>
                                <option value="psicologo">Psicólogo(a)</option>
                                <option value="nutricionista">Nutricionista</option>
                                <option value="trabajador_social">Trabajador Social</option>
                                <option value="estudiante_salud">Estudiante de Ciencias de la Salud</option>
                                <option value="administrativo">Personal administrativo</option>
                                <option value="otro">Otro no listado</option>
                            </select>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="region" class="inline-block text-sm text-gray-800 mt-2.5 dark:text-neutral-200">
                                Región
                            </label>
                        </div>
                        
                        <div class="sm:col-span-9">
                            <select id="region" name="region" onchange="actualizarUnidades()"
                                    class="py-2 px-3 pe-9 block w-full border-gray-200 shadow-sm text-sm rounded-lg focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600" required>
                                <option value="">Seleccione una provincia / región</option>
                                <option value="panama">Panamá</option>
                                <option value="sanmiguelito">San Miguelito</option>
                                <option value="panamaoeste">Panamá Oeste</option>
                                <option value="panamaeste">Panamá Este</option>
                                <option value="bocasdeltoro">Bocas del Toro</option>
                                <option value="cocle">Coclé</option>
                                <option value="colon">Colón</option>
                                <option value="chiriqui">Chiriquí</option>
                                <option value="herrera">Herrera</option>
                                <option value="lossantos">Los Santos</option>
                                <option value="veraguas">Veraguas</option>
                            </select>
                        </div>

                        <div class="sm:col-span-3">
                            <label for="unidad" class="inline-block text-sm text-gray-800 mt-2.5 dark:text-neutral-200">
                                Unidad Ejecutora
                            </label>
                        </div>
                        
                        <div class="sm:col-span-9">
                            <select id="unidad" name="unidad"
                                    class="py-2 px-3 pe-9 block w-full border-gray-200 shadow-sm text-sm rounded-lg focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600" required>
                                <option value="">Seleccione una unidad ejecutora</option>
                            </select>
                        </div>

                        <div class="sm:col-span-12">
                            <div class="flex gap-x-2">
                                <button type="submit" 
                                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none">
                                    <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M5 12h14"/>
                                        <path d="M12 5v14"/>
                                    </svg>
                                    Preregistrar Participante
                                </button>
                                
                                <a href="{{ url_for('checkin_evento', codigo_evento=evento.codigo) }}" 
                                   class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 focus:outline-none focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-700 dark:focus:bg-neutral-700">
                                    Volver al Check-in
                                </a>
                            </div>
                        </div>

                    </div>
                </form>

                <!-- Información adicional -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-neutral-700">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-neutral-200 mb-4">
                        Información
                    </h3>
                    <ul class="text-sm text-gray-600 dark:text-neutral-400 space-y-2">
                        <li class="flex items-start">
                            <svg class="shrink-0 size-4 mt-0.5 me-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            Los participantes preregistrados manualmente se añaden a la misma lista que los cargados por CSV.
                        </li>
                        <li class="flex items-start">
                            <svg class="shrink-0 size-4 mt-0.5 me-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            Puede usar esta opción para añadir participantes individuales sin necesidad de crear un archivo CSV.
                        </li>
                        <li class="flex items-start">
                            <svg class="shrink-0 size-4 mt-0.5 me-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            Los participantes preregistrados podrán confirmar su asistencia durante el evento usando el sistema de validación.
                        </li>
                    </ul>
                </div>

            </div>
            <!-- End Card -->
        </div>
    </main>

    <script>
    function validarCedula(input) {
        const cedula = input.value.trim();
        input.value = cedula;
        const errorMessage = document.getElementById('cedula-error');

        const patrones = [
            /^(PE|E|N|\d{1,2}(AV|PI)?)-\d{1,4}-\d{1,6}$|^[A-Z]{2}\d{6,20}$/
        ];

        // Verificar si la cédula cumple con alguno de los patrones
        const esValido = patrones.some(patron => patron.test(cedula));

        if (esValido) {
            input.classList.remove('border-red-500');
            input.classList.add('border-gray-200');
            errorMessage.classList.add('hidden');
        } else {
            input.classList.remove('border-gray-200');
            input.classList.add('border-red-500');
            errorMessage.classList.remove('hidden');
        }
    }

    // Limpiar formulario después de envío exitoso
    document.addEventListener('DOMContentLoaded', function() {
        const successMessage = document.querySelector('.bg-green-100');
        if (successMessage) {
            setTimeout(() => {
                document.getElementById('nombres').value = '';
                document.getElementById('apellidos').value = '';
                document.getElementById('cedula').value = '';
                document.getElementById('perfil_profesional').value = '';
                document.getElementById('region').value = '';
                document.getElementById('unidad').value = '';
                document.getElementById('nombres').focus();
            }, 1500);
        }
    });
    </script>

    <script>
    const unidadesPorProvincia = {
        panama: [
            "Ciudad De La Salud",
            "Complejo Hospitalario Metropolitano Dr. Arnulfo Arias Madrid",
            "Hospital de Especialidades Pediátricas Omar Torrijos Herrera",
            "Policlínica Presidente Remón",
            "Policlínica Dr. Manuel Ferrer Valdés",
            "Policlínica Dr. Carlos N. Brin",
            "Policlínica Don Alejandro De La Guardia Hijo",
            "Policlínica Don Joaquín José Vallarino",
            "ULAPS Máximo Herrera",
            "ULAPS Prof. Carlos Velarde",
            "CAPPS Plaza Tocumen",
            "CAPPS Pedregal",
            "CAPPS Los Nogales",
            "Otra unidad"
        ],
        sanmiguelito: [
            "Hospital Dra. Susana Jones Cano",
            "Policlínica Lic. Manuel María Valdés",
            "Policlínica Don Generoso Guardia",
            "Policlínica Dr. Edilberto Culiolis",
            "Policlínica Dra. Cecilia Guerra",
            "CAPPS Torrijos Carter",
            "Otra unidad"
        ],
        panamaoeste: [
            "Hospital Hogar de La Esperanza",
            "Policlínica Dr. Santiago Barraza",
            "Policlínica Dr. Blas Gómez Chetro",
            "Policlínica Dr. Juan Vega Méndez",
            "ULAPS Vista Alegre",
            "ULAPS Guadalupe",
            "ULAPS San José",
            "CAPPS Capira",
            "CAPPS Vacamonte",
            "CAPPS El Tecal",
            "Otra unidad"
        ],
        panamaeste: [
            "Hospital Regional de Chepo",
            "Hospital Irma de Lourdes Tzanetatos",
            "Policlínica de Cañitas",
            "Otra unidad"
        ],
        bocasdeltoro: [
            "Hospital Regional de Changuinola",
            "Hospital Regional de Almirante",
            "Hospital de Chiriquí Grande",
            "Policlínica de Guabito",
            "ULAPS Las Tablas",
            "Otra unidad"
        ],
        cocle: [
            "Hospital Regional Dr. Rafael Estévez",
            "Policlínica Dr. Manuel De Jesús Rojas",
            "Policlínica San Juan De Dios",
            "Policlínica Dr. Manuel Paulino Ocaña",
            "Otra unidad"
        ],
        colon: [
            "Complejo Hospitalario Dr. Manuel Amador Guerrero",
            "Policlínica de Nuevo San Juan",
            "Policlínica de Sabanitas",
            "Policlínica Dr. Hugo Spadafora",
            "ULAPS Portobelo",
            "Otra unidad"
        ],
        chiriqui: [
            "Hospital Regional Dr. Rafael Hernández",
            "Hospital Dr. Dionisio Arrocha",
            "Policlínica Dr. Gustavo Adolfo Ross",
            "Policlínica Dr. Pablo Espinosa",
            "Policlínica Dr. Ernesto Perez Balladares",
            "Policlínica de Divalá",
            "ULAPS Nuevo Vedado",
            "ULAPS Volcán",
            "ULAPS Dolega",
            "CAPPS Barú",
            "CAPPS Jobito",
            "CAPPS Balsa",
            "CAPPS Blanco",
            "CAPPS Caoba",
            "CAPPS Corredor",
            "CAPPS Zapatero",
            "Otra unidad"
        ],
        herrera: [
            "Hospital Dr. Gustavo Nelson Collado",
            "Policlínica Dr. Roberto Ramírez De Diego",
            "CAPPS Los Pozos",
            "CAPPS Ocú",
            "CAPPS Pesé",
            "Otra unidad"
        ],
        lossantos: [
            "Policlínica Dr. Miguel Cárdenas Barahona",
            "Policlínica San Juan de Dios",
            "CAPPS Guararé",
            "CAPPS Tonosí",
            "CAPPS Macaracas",
            "Otra unidad"
        ],
        veraguas: [
            "Hospital Dr. Ezequiel Abadía",
            "Policlínica Dr. Horacio Díaz Gómez",
            "ULAPS Alberto León",
            "CAPPS Zapotillo",
            "Otra unidad"
        ]
    };
    
    function actualizarUnidades() {
        const provinciaSeleccionada = document.getElementById("region").value;
        const unidadSelect = document.getElementById("unidad");
        
        // Limpiar opciones previas
        unidadSelect.innerHTML = '<option value="">Seleccione una unidad ejecutora</option>';
        
        if (provinciaSeleccionada && unidadesPorProvincia[provinciaSeleccionada]) {
            unidadesPorProvincia[provinciaSeleccionada].forEach(unidad => {
                const option = document.createElement("option");
                option.value = unidad;
                option.textContent = unidad;
                unidadSelect.appendChild(option);
            });
        }
    }
    </script>

</body>
</html>