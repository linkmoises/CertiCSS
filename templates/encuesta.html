<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Encuesta de Satisfacci√≥n - {{ evento.nombre }} - CertiCSS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- favicons -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='assets/favicons/favicon-96x96.png') }}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='assets/favicons/favicon.svg') }}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='assets/favicons/apple-touch-icon.png') }}" />
    <meta name="apple-mobile-web-app-title" content="CertiCSS" />
    <link rel="manifest" href="{{ url_for('static', filename='assets/favicons/site.webmanifest') }}" />
{% if UMAMI_URL %}
    {{ UMAMI_URL | safe }}
{% endif %}
</head>
<body class="bg-gray-50 dark:bg-neutral-900">

    <!-- ========== MAIN CONTENT ========== -->
    <main id="content">

        <div class="max-w-[85rem] px-4 py-4 sm:px-6 lg:px-8 lg:py-4 mx-auto">
            
            <div class="max-w-xl mx-auto">
                <div class="text-center">
                    <a href="{{ url_for('home') }}">
                        <img src="{{ url_for('static', filename='assets/css-logo-192x192.png') }}" alt="Caja de Seguro Social" class="h-16 w-16 mx-auto mb-4">
                    </a>
                    <h1 class="text-3xl font-bold text-gray-800 sm:text-4xl dark:text-white">
                        Encuesta de satisfacci√≥n
                    </h1>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">{{ evento.nombre }}</h2>

                    <p class="mt-1 text-justify text-gray-600 dark:text-neutral-400">
                        Desde el <span class="font-bold">Departamento Nacional de Docencia e Investigaci√≥n (DENADOI)</span>, le invitamos a responder esta breve encuesta que nos permite conocer su percepci√≥n sobre la calidad del evento acad√©mico en el que particip√≥.
                    </p>
                    <p class="mt-1 text-justify text-gray-600 dark:text-neutral-400">
                        Su respuesta es importante para el proceso de mejora continua y es parte del cierre acad√©mico de la actividad, previo a la emisi√≥n del certificado de participaci√≥n.
                    </p>
                    <p class="mt-1 text-justify text-gray-600 dark:text-neutral-400">
                        La encuesta no tomar√° m√°s de 2 minutos. Agradecemos de antemano su tiempo y colaboraci√≥n.
                    </p>
                    
                    {% if already_completed %}
                    <div class="mt-4 p-4 bg-green-100 text-green-800 rounded-lg">
                        <p class="font-semibold">‚úì Encuesta completada</p>
                        <p class="mt-2">{% if just_completed %}¬°Gracias por completar la encuesta!{% else %}Ya ha completado esta encuesta. Gracias por su participaci√≥n.{% endif %}</p>
                        {% if nanoid %}
                        <div class="mt-4 space-y-2">
                            <a href="{{ url_for('generar_pdf', nanoid=nanoid) }}" class="inline-flex items-center justify-center w-full py-3 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">
                                <svg class="h-4 w-4 text-white me-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 640 512">
                                    <path d="M320 32c-8.1 0-16.1 1.4-23.7 4.1L15.8 137.4C6.3 140.9 0 149.9 0 160s6.3 19.1 15.8 22.6l57.9 20.9C57.3 229.3 48 259.8 48 291.9l0 28.1c0 28.4-10.8 57.7-22.3 80.8c-6.5 13-13.9 25.8-22.5 37.6C0 442.7-.9 448.3 .9 453.4s6 8.9 11.2 10.2l64 16c4.2 1.1 8.7 .3 12.4-2s6.3-6.1 7.1-10.4c8.6-42.8 4.3-81.2-2.1-108.7C90.3 344.3 86 329.8 80 316.5l0-24.6c0-30.2 10.2-58.7 27.9-81.5c12.9-15.5 29.6-28 49.2-35.7l157-61.7c8.2-3.2 17.5 .8 20.7 9s-.8 17.5-9 20.7l-157 61.7c-12.4 4.9-23.3 12.4-32.2 21.6l159.6 57.6c7.6 2.7 15.6 4.1 23.7 4.1s16.1-1.4 23.7-4.1L624.2 182.6c9.5-3.4 15.8-12.5 15.8-22.6s-6.3-19.1-15.8-22.6L343.7 36.1C336.1 33.4 328.1 32 320 32zM128 408c0 35.3 86 72 192 72s192-36.7 192-72L496.7 262.6 354.5 314c-11.1 4-22.8 6-34.5 6s-23.5-2-34.5-6L143.3 262.6 128 408z" />
                                </svg>
                                Descargar Certificado
                            </a>
                            <p class="text-sm text-gray-600">Tambi√©n puede acceder a su certificado desde la p√°gina de b√∫squeda de certificados.</p>
                        </div>
                        {% else %}
                        <p class="mt-2">Puede proceder a descargar su certificado desde la p√°gina de b√∫squeda de certificados.</p>
                        <div class="mt-4">
                            <a href="{{ url_for('buscar_certificados') }}" class="inline-block py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Ir a Mis Certificados
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    {% elif unregistered %}
                    <div class="mt-4 p-4 bg-red-100 text-red-800 rounded-lg">
                        <p class="font-semibold">‚úó C√©dula no registrada</p>
                        <p class="mt-2">Su c√©dula no est√° registrada para este evento. Por favor verifique que est√© correctamente escrita o contacte al organizador del evento.</p>
                    </div>
                    {% elif cedula_required %}
                    <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="font-semibold text-blue-800 mb-2">üìã Ingrese su c√©dula</p>
                        <p class="text-blue-700 mb-4">Para acceder a la encuesta, por favor ingrese su n√∫mero de c√©dula.</p>
                        <form method="POST" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 mb-2">N√∫mero de c√©dula</label>
                                <input type="text" name="cedula_input" placeholder="Ej: 8-123-4567" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                       required>
                            </div>
                            <button type="submit" class="w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                Continuar
                            </button>
                        </form>
                    </div>
                    {% else %}
                    
                    {% endif %}
                </div>
            </div>
      
            <div class="mb-8 max-w-lg mx-auto">

{% if not already_completed and not unregistered and not cedula_required and cedula %}
{% block content %}
                <form method="POST" class="space-y-8" id="encuestaForm">
                    <!-- Campo oculto para spam -->
                    <input type="email" name="email" class="hidden" autocomplete="off">
                    
                    <!-- Timestamp oculto para control de tiempo -->
                    <input type="hidden" name="timestamp_inicio" id="timestamp_inicio">
                    
                    <!-- Cedula oculta para validaci√≥n -->
                    <input type="hidden" name="cedula" value="{{ cedula }}">
                    
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Secci√≥n D: Datos demogr√°ficos</h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-gray-700 mb-2">D1. Sexo</label>
                                <div class="flex space-x-4">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="D1" value="Masculino" class="form-radio h-5 w-5 text-blue-600" required>
                                        <span class="ml-2">Masculino</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="D1" value="Femenino" class="form-radio h-5 w-5 text-blue-600" required>
                                        <span class="ml-2">Femenino</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-gray-700 mb-2">D2. Grupo de edad</label>
                                <select name="D2" class="py-2 px-3 pe-9 block w-full border-gray-200 shadow-sm rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500" required>
                                    <option value="">Seleccione su grupo de edad</option>
                                    {% for edad in ['20‚Äì30', '31‚Äì40', '41‚Äì50', '51‚Äì60', '61+'] %}
                                    <option value="{{ edad }}">{{ edad }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-gray-700 mb-2">D3. Perfil profesional</label>
                                <select name="D3" class="py-2 px-3 pe-9 block w-full border-gray-200 shadow-sm rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500" required>
                                    <option value="">Seleccione su perfil profesional</option>
                                    {% set perfiles = {
                                        'medico_administrativo': 'M√©dico Administrativo',
                                        'medico_general_ce': 'M√©dico General - Consulta Externa',
                                        'medico_general_urg': 'M√©dico General - Urgencias',
                                        'medico_especialista': 'M√©dico Especialista',
                                        'odontologo': 'Odont√≥logo(a)',
                                        'odontologo_especialista': 'Odont√≥logo(a) Especialista',
                                        'enfermero': 'Enfermera(o)',
                                        'tecnico_enfermeria': 'T√©cnico en Enfermer√≠a',
                                        'laboratorista': 'Laboratorista',
                                        'tecnico_laboratorio': 'T√©cnico de Laboratorio',
                                        'fisioterapeuta': 'Fisioterapeuta',
                                        'farmaceutico': 'Farmac√©utico(a)',
                                        'fonoaudiologo': 'Fonoaudi√≥logo(a)',
                                        'psicologo': 'Psic√≥logo(a)',
                                        'nutricionista': 'Nutricionista',
                                        'trabajador_social': 'Trabajador Social',
                                        'estudiante_salud': 'Estudiante de Ciencias de la Salud',
                                        'administrativo': 'Personal administrativo',
                                        'otro': 'Otro no listado'
                                    } %}
                                    {% for value, label in perfiles.items() %}
                                    <option value="{{ value }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-gray-700 mb-2">D4. Nivel de atenci√≥n donde labora principalmente</label>
                                <select name="D4" class="py-2 px-3 pe-9 block w-full border-gray-200 shadow-sm rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500" required>
                                    <option value="">Seleccione el nivel de atenci√≥n</option>
                                    {% set niveles = {
                                        '0': 'Unidades administrativas',
                                        '1': 'I nivel (CAPPS, ULAPS)',
                                        '2': 'II nivel (Policl√≠nicas, Policl√≠nicas-Hospitales, Hospitales regionales)',
                                        '3': 'III nivel (Hospitales de referencia nacional)',
                                        '4': 'IV nivel (Institutos especializados)'
                                    } %}
                                    {% for value, label in niveles.items() %}
                                    <option value="{{ value }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div>
                                <label class="block text-gray-700 mb-2">D5. A√±os de experiencia profesional</label>
                                <select name="D5" class="py-2 px-3 pe-9 block w-full border-gray-200 shadow-sm rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500" required>
                                    <option value="">Seleccione sus a√±os de experiencia</option>
                                    {% for exp in ['<5', '5‚Äì10', '11‚Äì20', '21‚Äì30', '31‚Äì40', '+40'] %}
                                    <option value="{{ exp }}">{{ exp }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n E: Evaluaci√≥n del Evento -->
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Evaluaci√≥n del Evento</h3>
                        <p class="text-sm text-gray-600 mb-4">Escala Likert 1‚Äì5: [1 = Totalmente en desacuerdo | 5 = Totalmente de acuerdo]</p>
                        
                        <div class="space-y-6">
                            {% set preguntas_evento = [
                                ('E1', 'El contenido fue pertinente para mi pr√°ctica'),
                                ('E2', 'La informaci√≥n fue clara y comprensible'),
                                ('E3', 'El contenido estuvo cient√≠ficamente actualizado'),
                                ('E4', 'El ponente demostr√≥ dominio del tema'),
                                ('E5', 'La organizaci√≥n del evento fue adecuada')
                            ] %}
                            
                            {% for codigo, pregunta in preguntas_evento %}
                            <div>
                                <label class="block text-gray-700 mb-2">{{ codigo }}. {{ pregunta }}</label>
                                <div class="flex justify-between">
                                    {% for i in range(1, 6) %}
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="{{ codigo }}" value="{{ i }}" class="form-radio h-5 w-5 text-blue-600" required>
                                        <span class="ml-1">{{ i }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Comentario abierto -->
                    <div class="bg-white p-6 rounded-lg border">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Comentarios</h3>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">¬øQu√© mejorar√≠a de este evento?</label>
                            <textarea name="C1" rows="4" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Escriba sus sugerencias aqu√≠..."></textarea>
                        </div>
                    </div>

                    <div class="justify-center">
                        <button type="submit" class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-hidden focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none">
                            Enviar Encuesta
                        </button>
                    </div>
                </form>
{% endblock %}
{% endif %}

            </div>
        </div>

    </main>
    <!-- ========== END MAIN CONTENT ========== -->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const timestampField = document.getElementById('timestamp_inicio');
        if (timestampField) {
            timestampField.value = Date.now();
        }
    });

    const encuestaForm = document.getElementById('encuestaForm');
    if (encuestaForm) {
        encuestaForm.addEventListener('submit', function(e) {
            const tiempoInicio = parseInt(document.getElementById('timestamp_inicio').value);
            const tiempoActual = Date.now();
            const tiempoTranscurrido = (tiempoActual - tiempoInicio) / 1000; // en segundos

            if (tiempoTranscurrido < 10) {
                e.preventDefault();
                alert('¬°Gracias por completar la encuesta!');
                return false;
            }
        });
    }
</script>
</body>
</html>